(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,s=window.wp.i18n,r=window.wp.components,n=window.wp.element,o=window.wp.data,a=window.wp.api;var l=e.n(a);const c=window.wp.apiFetch;var i=e.n(c);const p=window.wp.notices,m=()=>{const e=(0,o.useSelect)((e=>e(p.store).getNotices().filter((e=>"snackbar"===e.type))),[]),{removeNotice:s}=(0,o.useDispatch)(p.store);return(0,t.createElement)(r.SnackbarList,{className:"edit-site-notices",notices:e,onRemove:s})};function u(){const[e,a]=(0,t.useReducer)(((e,t)=>({...e,...t})),{isLoaded:!1,settings:{active:!0,authentication:!1,token:"",storage:"apc",features:{emails:!0,errors:!0,options:!0,posts:!0,queries:!0,requests:!0,remote_requests:!0,updates:!0,users:!0}}}),{isLoaded:c,settings:p}=e,{active:u,authentication:d,token:_,features:h}=p;return(0,t.useEffect)((()=>{l().loadPromise.then((()=>{const e=new(l().models.Settings);!1===c&&e.fetch().then((e=>{null!==e.prompress_settings&&a({isLoaded:!0,settings:{active:e.prompress_settings.active,authentication:e.prompress_settings.authentication,token:e.prompress_settings.token,features:e.prompress_settings.features}}),a({isLoaded:!0})})).catch((e=>{e.log(e)}))}))}),[]),(0,t.useEffect)((()=>{i()({method:"GET",path:"/prompress/v1/storage/compatibility"}).then((e=>{a({isStorageCompatLoaded:!0,storageCompat:e})})).catch((e=>{e.log(e)}))}),[]),c?(0,t.createElement)(n.Fragment,null,(0,t.createElement)("div",{className:"prompress__header"},(0,t.createElement)("div",{className:"prompress__container"},(0,t.createElement)("div",{className:"prompress__title"},(0,t.createElement)("h1",null,(0,s.__)("PromPress Settings","prompress")," ",(0,t.createElement)(r.Icon,{icon:"admin-plugins"}))))),(0,t.createElement)("div",{className:"prompress__main"},(0,t.createElement)("div",{className:"components-panel"},(0,t.createElement)("div",{className:"components-panel__body is-opened"},(0,t.createElement)("h2",{className:"components-panel__body-title"},(0,s.__)("General","prompress")),(0,t.createElement)("p",null,"You can control whether monitoring is active or inactive globally."),(0,t.createElement)(r.ToggleControl,{label:"Active",help:u?"Monitoring is active.":"Monitoring is not active.",checked:u,onChange:()=>{a({settings:{...p,active:!u}})}}),(0,t.createElement)(r.Button,{variant:"secondary",onClick:()=>{i()({method:"GET",path:"/prompress/v1/storage/wipe"}).then((()=>{(0,o.dispatch)("core/notices").createNotice("success",(0,s.__)("Storage wiped","prompress"),{type:"snackbar",isDismissible:!0})})).catch((e=>{(0,o.dispatch)("core/notices").createNotice("success",(0,s.__)("Failed to wipe storage","prompress"),{type:"snackbar",isDismissible:!0})}))}},(0,s.__)("Wipe Storage","prompress")))),(0,t.createElement)("div",{className:"components-panel"},(0,t.createElement)("div",{className:"components-panel__body is-opened"},(0,t.createElement)("h2",{className:"components-panel__body-title"},(0,s.__)("REST API","prompress")),(0,t.createElement)("p",null,"Enable authentication for the metrics endpoint."),(0,t.createElement)(r.ToggleControl,{label:(0,s.__)("Require Authentication","prompress"),help:d?"Authentication is required.":"Authentication is not required.",checked:d,onChange:()=>{a({settings:{...p,authentication:!d}})}}),d&&(0,t.createElement)(n.Fragment,null,(0,t.createElement)(r.TextControl,{label:(0,s.__)("Bearer Token","prompress"),value:_,onChange:e=>{a({settings:{...p,token:e}})},help:(0,s.__)("Set a bearer token which must be sent by Prometheus to access the metrics endpoint.","prompress")})))),(0,t.createElement)("div",{className:"components-panel"},(0,t.createElement)("div",{className:"components-panel__body is-opened"},(0,t.createElement)("h2",{className:"components-panel__body-title"},(0,s.__)("Features","prompress")),(0,t.createElement)("p",null,"Toggle the following features on/off to control what is being monitored."),(0,t.createElement)(r.ToggleControl,{label:(0,s.__)("Emails","prompress"),help:(0,s.__)("Track the number of emails sent.","prompress"),checked:h.emails,onChange:()=>{a({settings:{...p,features:{...h,emails:!h.emails}}})}}),(0,t.createElement)(r.ToggleControl,{label:(0,s.__)("Errors","prompress"),help:(0,s.__)("Track the number of errors thrown.","prompress"),checked:h.errors,onChange:()=>{a({settings:{...p,features:{...h,errors:!h.errors}}})}}),(0,t.createElement)(r.ToggleControl,{label:(0,s.__)("Options","prompress"),help:(0,s.__)("Track the number of options.","prompress"),checked:h.options,onChange:()=>{a({settings:{...p,features:{...h,options:!h.options}}})}}),(0,t.createElement)(r.ToggleControl,{label:(0,s.__)("Posts","prompress"),help:(0,s.__)("Track the number of posts (with post type).","prompress"),checked:h.posts,onChange:()=>{a({settings:{...p,features:{...h,posts:!h.posts}}})}}),(0,t.createElement)(r.ToggleControl,{label:(0,s.__)("Queries","prompress"),help:(0,s.__)("Track the number and length of database queries. Note: The `SAVEQUERIES` constant must be set and true.","prompress"),checked:h.queries,onChange:()=>{a({settings:{...p,features:{...h,queries:!h.queries}}})}}),(0,t.createElement)(r.ToggleControl,{label:(0,s.__)("Requests","prompress"),help:(0,s.__)("Track the number and length of requests.","prompress"),checked:h.requests,onChange:()=>{a({settings:{...p,features:{...h,requests:!h.requests}}})}}),(0,t.createElement)(r.ToggleControl,{label:(0,s.__)("Remote Requests","prompress"),help:(0,s.__)("Track the number and length of remote requests.","prompress"),checked:h.remote_requests,onChange:()=>{a({settings:{...p,features:{...h,remote_requests:!h.remote_requests}}})}}),(0,t.createElement)(r.ToggleControl,{label:(0,s.__)("Updates","prompress"),help:(0,s.__)("Track the number of plugin and theme updates available.","prompress"),checked:h.updates,onChange:()=>{a({settings:{...p,features:{...h,updates:!h.updates}}})}}),(0,t.createElement)(r.ToggleControl,{label:(0,s.__)("Users","prompress"),help:(0,s.__)("Track the number of users (with role).","prompress"),checked:h.users,onChange:()=>{a({settings:{...p,features:{...h,users:!h.users}}})}})))),(0,t.createElement)("div",{className:"prompress__save"},(0,t.createElement)(r.Button,{variant:"primary",onClick:()=>{new(l().models.Settings)({prompress_settings:p}).save(),(0,o.dispatch)("core/notices").createNotice("success",(0,s.__)("Settings Saved","prompress"),{type:"snackbar",isDismissible:!0})}},(0,s.__)("Save","prompress"))),(0,t.createElement)("div",{className:"prompress__notices"},(0,t.createElement)(m,null))):(0,t.createElement)(r.Placeholder,null,(0,t.createElement)(r.Spinner,null))}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("prompress-plugin-settings");e&&(0,n.render)((0,t.createElement)(u,null),e)}))})();